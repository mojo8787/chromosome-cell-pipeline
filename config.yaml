# Chromosome + Cell Mini-Pipeline Configuration
# Paths and parameters for reproducibility

paths:
  data_dir: "./data"
  hic_dir: "./data/hic"
  microscopy_dir: "./data/microscopy"
  output_dir: "./output"

hic:
  resolution: 100000  # 100 kb (manageable for demo)
  chromosomes: ["chr2", "chr17"]  # HFF_MicroC has chr2, chr17
  download_dataset: "HFF_MicroC"

microscopy:
  bbbc039_url: "https://data.broadinstitute.org/bbbc/BBBC039/images.zip"
  subset_size: 20  # Use first N images for fast demo (set to null for all)
  stardist_model: "2D_versatile_he"

vlm:
  backend: "openai"  # openai or anthropic
  model: "gpt-4o"  # gpt-4o for OpenAI; claude-3-5-sonnet for Anthropic
  api_key_env: "OPENAI_API_KEY"
  # server_key_only: true = hide API key input, use only Streamlit secrets (for public deploy)
  server_key_only: true
  max_images: 5  # limit for demo to control API cost; null for all
  prompt: "Describe the nuclei morphology, chromatin distribution, and any notable phenotypic features in this fluorescence microscopy image. Be concise."
  # structured_output: true = return JSON {nuclei_count, morphology, phenotype} (OpenAI only)
  structured_output: true
  # Joint Hi-C + microscopy: generative phenotyping prompt (OpenAI only)
  joint_prompt: "You are shown two images. Image 1 (top): a Hi-C contact map showing chromatin organization, TAD boundaries, and contact domains. Image 2 (bottom): a fluorescence microscopy image of nuclei. Describe the relationship between the chromatin contact patterns in the Hi-C map and the nuclear staining/morphology in the microscopy image. What might they tell us together? Be concise and scientific."

# Rate limiting for AI analysis ( protects your API credits )
# Public deployment: 5/session, 60s between runs
rate_limit:
  max_analyses_per_session: 5
  min_seconds_between_analyses: 60
  warning_at_remaining: 1  # show warning when this many analyses left

qc_thresholds:
  hic:
    min_bins: 100
    max_sparsity: 0.9999
  microscopy:
    min_nuclei_per_image: 20
    min_images: 5
    circularity_low: 0.6
    circularity_high: 0.95
